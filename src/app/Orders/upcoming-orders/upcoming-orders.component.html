<div class="container-fluid">
  <div class="logo2">
    <div class="card m-1">
      <h3 class="card-header d-flex flex-column justify-content-center">
        <span> <img src="../../../assets/imagesuiux/review.png" style="width: 40px;height: 40px;">
        <b> Upcoming Orders (即将到来的订单)</b>
        </span>
      </h3>
      <div class="card-body" style="margin-top: -47px !important">
        <div class="filter">
          <form [formGroup]="upcomingForm" (ngSubmit)="onSubmit()">
            <div class="row mobile-customer-project">
              <ngb-accordion #acc="ngbAccordion" [activeIds]="['panel1']" class="mobile2" style="padding-top: 14px">
                <ngb-panel id="panel1">
                  <!-- <ng-template ngbPanelTitle>
                                      <span style="color:#0880ae;"><b>Filters</b></span>
                                  </ng-template> -->
                  <ng-template ngbPanelContent>
                    <div class="card-body" style="padding: 0.5%">
                      <div class="row">
                        <div class="col-md-3">
                          <label class="form-label">Customer</label> <br />
                          <ng-select formControlName="customer" class="w-auto" (change)="changecustomer($event)">
                            <ng-option *ngFor="let sList of CustomerList" [value]="sList.CustomerCode">
                              {{ sList.CustomerName }} ({{sList.CustomerCode}})
                            </ng-option>
                          </ng-select>
                        </div>

                        <div class="col-md-3">
                          <label class="form-label">Project</label> <br />
                          <ng-select formControlName="project" [(ngModel)]="SelectedProjectCodes" [closeOnSelect]="false"
                            class="w-auto" [multiple]="true" (change)="changeproject($event)"
                            style="max-height: 65px; z-index: 5">
                            <ng-template ng-header-tmp *ngIf="ProjectList.length != 0">
                              <div style="
                                  justify-content: space-between;
                                  display: flex;
                                ">
                                <button class="btn btn-link" style="padding: 4px; border: 0px; margin: 0px"
                                  (click)="selectAllProject()">
                                  Select All
                                </button>
                                <button class="btn btn-link" style="padding: 4px; border: 0px; margin: 0px"
                                  (click)="clearAllProject()">
                                  Clear All
                                </button>
                              </div>
                            </ng-template>
                            <ng-option *ngFor="let sList of ProjectList" [value]="sList.ProjectCode" >
                              {{ sList.ProjectTitle }}
                            </ng-option>
                          </ng-select>
                        </div>
                      </div>
                    </div>
                  </ng-template>
                </ngb-panel>
              </ngb-accordion>
            </div>
          </form>


          <div class="row logo2 customerandprojecthideonweb">
            <div class="col-md-7"></div>
            <div class="col-md-4 float-right">
              <label class="form-label"></label> <br />
              <div class="input-group flex-nowrap" *ngIf="searchResult" style="padding-right: 30px">
                <input class="form-control" type="search" placeholder="Search (查找)" value="search"
                  id="example-search-input" name="search" [(ngModel)]="searchText"
                  [ngModelOptions]="{ standalone: true }" />
                <span class="input-group-append ms-n5">
                  <span class="input-group-text">
                    <i class="bi bi-search"></i>
                  </span>
                </span>
              </div>
            </div>
            <div class="col-md-1">
              <label class="form-label"></label> <br />
              <div class="input-group flex-nowrap">
                <div class="mr-0 d-flex" style="margin-top: -6px">
                  <span class="btn input-group-text">
                    <i class="material-icons" style="font-size: 20px" matTooltip="Export   (导出)"
                      (click)="ExportToExcel()">download</i> </span>&nbsp;&nbsp;
                  <span class="btn input-group-text" (click)="editColumn = !editColumn"  (mouseenter)="HoverSetting=true"
                  (mouseleave)="HoverSetting=false"><i class="bi bi-gear-fill" style="font-size: medium; z-index: 1"
                      matTooltip="Edit Column"></i></span>
                </div>
              </div>
            </div>
          </div>
          <div class="setting-menu float-right logo2"
            [class.mat-elevation-z8]="true" *ngIf="editColumn" (mouseenter)="HoverSetting=true" (mouseleave)="HoverSetting=false">
            <div class="d-flex heading">
              <div class="d-flex" style="width: 50%; justify-content: space-between">
                <label class="fixed-xolumn-head">Fixed Columns: </label>
                <input class="form-control" type="number" max="7" min="0" [(ngModel)]="fixedColumn"
                  (change)="UpdateFixedColumns()" />
              </div>
              <button type="button" class="btn-close" aria-label="Close" (click)="editColumn = false"></button>
            </div>
            <hr style="margin: 10px;border-top: 1px solid #101112;" />
            <div class="d-flex" style="
                                    justify-content: space-between;
                                    align-items: flex-end;
                                    padding-left: 5px;
                                  ">
              <span>Visible Columns</span>
            </div>
            <div class="d-flex">
              <table class="table table-bordered mobile2" style="height: fit-content" style="min-width: 0">
                <tbody>
                  <tr *ngFor="let headerColumn of splitArray(1, upcomingColumns)">
                    <td>{{ headerColumn.displayName }}</td>
                    <td>
                      <input type="checkbox" [(ngModel)]="headerColumn.isVisible" [checked]="headerColumn.isVisible"
                        (change)="UpdateVisibleColumns()" />
                    </td>
                  </tr>
                </tbody>
              </table>
              <table class="table table-bordered mobile2" style="height: fit-content" style="min-width: 0">
                <tbody>
                  <tr *ngFor="let headerColumn of splitArray(0, upcomingColumns)">
                    <td>{{ headerColumn.displayName }}</td>
                    <td>
                      <input type="checkbox" [(ngModel)]="headerColumn.isVisible" [checked]="headerColumn.isVisible"
                        (change)="UpdateVisibleColumns()" />
                    </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>
          <div *ngIf="UpcomingOrderLoading" style="z-index: 500">
            <div id="pause" class="d-flex align-items-center justify-content-center">
              <div id="spinner" class="loader"></div>
            </div>
          </div>
          <div>
            <div class="table-responsive table-wrapper-scroll-y my-custom-scrollbar order-table">
              <cdk-virtual-scroll-viewport itemSize="50" #scrollViewportENT (scroll)="syncScroll($event)" style="height: 55vh;">

              <form [formGroup]="searchForm">

                <table class="table new-table">

                  <thead [style.top]="inverseOfENT" id="UpcomingOrderHeading" [ngStyle]="{ position: 'sticky', top: '0px' }">
                    <tr [style.top]="inverseOfENT" cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="upcomingColumns"
                      (cdkDropListDropped)="dropCol($event)">
                      <ng-container *ngFor="
                          let headerColumn of upcomingColumns;
                          index as headIndex
                        ">
                        <th [style.top]="inverseOfENT" cdkDrag #thNomVar (click)="
                            toggleSortingOrder(
                              headerColumn.field,
                              headerColumn.colName
                            )
                          "  [style.cursor]="'pointer'" [style.left]="
                            headIndex + 1 <= getFixedCols()
                              ? getRightWidthTest(thNomVar, headIndex)
                              : 'inherit'
                          " [style.display]="'table-cell'" [class.FixedColumn]="headIndex + 1 <= getFixedCols()"
                          *ngIf="headerColumn.isVisible" style="cursor: pointer">
                          <div class="d-flex" style="
                              align-items: center;
                              justify-content: space-between; border-radius: 0px;
                            " [style.max-width.px]="headerColumn.resizeWidth">
                            <span style="color: white; font-size: medium;" [style.max-width.px]="headerColumn.resizeWidth">
                              {{ headerColumn.displayName }}<br />{{
                              headerColumn.chineseDisplayName
                              }}</span><i class="bi bi-arrow-up" *ngIf="
                                !isAscending &&
                                currentSortingColumn == headerColumn.field
                              "></i><i class="bi bi-arrow-down" *ngIf="
                                isAscending &&
                                currentSortingColumn == headerColumn.field
                              "></i>
                          </div>
                          <div [style.width.px]="headerColumn.resizeWidth"></div>
                        </th>
                      </ng-container>

                      <th [style.top]="inverseOfENT" width="4%"  style="color: white; font-size: medium;border-radius: 0px;">SELECT<br />选项</th>
                      <th [style.top]="inverseOfENT" width="4%"  style="color: white; font-size: medium;border-radius: 0px;">
                        ACTION<br />行动
                      </th>
                    </tr>
                  </thead>
                  <thead [style.top]="inverseOfENTSearch" id="searchBar" *ngIf="toggleFilters" [ngStyle]="{
                      position: 'sticky',
                      'top.px': getMinHeightIncoming('UpcomingOrderHeading')
                    }">
                    <tr [style.top]="inverseOfENTSearch">
                      <ng-container  *ngFor="
                          let searchColumn of upcomingColumns;
                          let j = index
                        ">
                        <th class="resize-column" style="text-align: center;background-color: white !important;"
                          [style.width]="searchColumn.width + 'px !important'" [style.left]="
                            j + 1 <= getFixedCols() ? searchColumn.left + 'px !important'
                              : 'inherit'
                          " [style.display]="'table-cell'" [class.FixedColumn]="j + 1 <= getFixedCols()" *ngIf="
                            searchColumn.isVisible &&
                            searchColumn.controlName != 'RequiredDate'
                          ">
                            <ng-select [style.width]="searchColumn.width + 'px !important'" formControlName="{{ searchColumn.controlName }}"
                              *ngIf="searchColumn.controlName != 'SSNNo' && searchColumn.controlName=='WBS1' " class="w-auto"
                              (change)="filterAllData()" appendTo="body" (keydown)="DeleteWBS1($event,searchColumn.controlName)">
                              <ng-option *ngFor="let sList of distinctNamesWBS1" [value]="sList">
                                {{sList}}
                              </ng-option>
                            </ng-select>
                            <ng-select [style.width]="searchColumn.width + 'px !important'" formControlName="{{ searchColumn.controlName }}"
                              *ngIf="searchColumn.controlName != 'SSNNo' && searchColumn.controlName=='WBS2' " class="w-auto"
                              (change)="filterAllData()" appendTo="body" (keydown)="DeleteWBS2($event,searchColumn.controlName)">
                              <ng-option *ngFor="let sList of distinctNamesWBS2 " [value]="sList" appendTo="body">
                                {{sList}}
                              </ng-option>
                            </ng-select>
                            <ng-select [style.width]="searchColumn.width + 'px !important'" formControlName="{{ searchColumn.controlName }}"
                              *ngIf="searchColumn.controlName != 'SSNNo' && searchColumn.controlName=='WBS3' " class="w-auto"
                              (change)="filterAllData()" appendTo="body" (keydown)="DeleteWBS3($event,searchColumn.controlName)">
                              <ng-option *ngFor="let sList of distinctNamesWBS3" [value]="sList">
                                {{sList}}
                              </ng-option>
                            </ng-select>
                            <input class="form-control" formControlName="{{ searchColumn.controlName }}" *ngIf="searchColumn.controlName != 'SSNNo' && searchColumn.controlName!='WBS1' && searchColumn.controlName!='WBS2' && searchColumn.controlName!='WBS3'" />
                          <div class="bar" appColumnResize [colName]="searchColumn.controlName" [colIndex]="j"
                            (widthChangeEvent)="onWidthChange($event)" cdkDrag></div>
                        </th>
                        <th class="resize-column" style="text-align: center;background-color: white !important;" *ngIf="
                            searchColumn.isVisible &&
                            searchColumn.controlName == 'RequiredDate'
                          ">
                          <app-bootsrtap-date-range-picker-for-search [clearInput]="clearInput"
                            [controlName]="searchColumn.controlName" (dateRangeSelection)="onGetDateSelected($event)">
                          </app-bootsrtap-date-range-picker-for-search>
                        </th>
                      </ng-container>
                      <th style="background-color: white !important;"></th>
                      <th style="background-color: white !important;">
                        <span style="margin: auto; padding: 2px">
                          <i class="fa fa-refresh" matTooltip="Reset" style="color: red; font-size: 20px"
                            (click)="Reset_Filter()"></i>&nbsp;
                          <label (click)="Reset_Filter()">Clear</label>
                        </span>
                      </th>
                    </tr>
                  </thead>
                  <!--Updated tbody-->
                  <tbody>
                    <tr *ngIf="upcomingArray.length == 0" style="text-align: center">
                      <td  colspan="18" style="text-align: center">
                        No Record Found
                      </td>
                    </tr>
                    <ng-container *ngFor="
                                        let item of upcomingArray | filter : searchText;
                                        index as i
                                      ">
                      <tr [class.highlight]="selectedRowIndex === i" [class.deleted-orders]="checkCancelled(item)" [class.converted-order]="checkConverted(item)" [class.notified-order]="checkNotified(item)"  (click)="selectRow(item,upcomingArray,$event)" [class.selected-draft-table]="item.rowSelected"
                        (click)="changeColor(i);scrollToTop();">
                        <td *ngIf="upcomingColumns[0].isVisible" [style.background]="'inherit'" [style.z-index]="'12'" [style.left]="getFixedCols()>0?'0':'inherit'"[style.display]="'table-cell'">{{item['SSNNo'] }}</td>
                        <ng-container *ngFor="let showDataColumn of upcomingColumns;index as searchIndex">
                          <td [style.width]="showDataColumn.width+ 'px !important'"
                            [style.left]="(searchIndex+1) <= getFixedCols() ? showDataColumn.left+'px !important' : 'inherit'"
                            [style.display]="'table-cell'" [class.FixedColumn]="(searchIndex+1) <= getFixedCols()"
                            *ngIf="showDataColumn.isVisible && showDataColumn.colName!='SSNNo'"> {{
                            item[showDataColumn.colName] }}</td>
                        </ng-container>
                        <td>
                          <input type="checkbox" [checked]="item.isSelected" (click)="SelectAllChecked(item)" (change)="recordSelected(item,i)" />
                        </td>
                        <td *ngIf="showDetails">
                          <i></i>
                          <i class="bi bi-info-circle-fill info-circle" [matTooltip]="'Notification Info'"
                            (click)="OpenNotificationInfo(item)"></i>&nbsp;
                          <i class="bi bi-eye" [matTooltip]="'View Details'" (click)="ViewOrderDetails(item)"
                            style="font-size:medium;" *ngIf="(item.ConvertedOrderNo !=0  && item.ConvertedOrderNo != undefined)"></i>&nbsp;
                        </td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </form>
            </cdk-virtual-scroll-viewport>
            </div>

            <div id="special-note" class="special-note" *ngIf="gSpecialNote != ''">Note - {{gSpecialNote}}</div>
            <div style="display: flex; flex-wrap: nowrap; justify-content: space-between;margin-top: 21px;">
              <div id="color-legends" class="color-legends">
                <span _ngcontent-nlc-c225="" style=" font-weight: bold;" class="ng-tns-c225-25"> Color
                  Legend:</span>&nbsp;
                <span class="box color font-weight-bold" style="background-color: #b5f77b">Converted Orders</span>&nbsp;
                <span class="box color font-weight-bold" style="background-color: #ffe47c">Notification
                  Sent</span>&nbsp;
              </div>
              <div *ngIf="!showDeletedUpcomingOrders">
                <button class="btn btn-danger btn-sm" *ngIf="isExternalUser()" style="width: 120px" type="button" (click)="ShowDeletedOrders()">
                  Deleted Orders
                </button>
                <button class="btn btn-primary btn-sm" *ngIf="isExternalUser()" style="width: 120px" type="button" (click)="openNotification()">
                  Send Notification
                </button>
                <button class="btn btn-primary btn-sm" style="width: 120px" type="button" (click)="ConvertToOrder()">
                  Convert To Order
                </button>
                <button class="btn btn-primary btn-sm" *ngIf="isExternalUser()" style="width: 80px" type="button" (click)="DeleteOrders()">
                  Delete
                </button>
                <button class="btn btn-primary btn-sm" type="button" (click)="SelectAll(true)">
                  Select All
                </button>
                <button class="btn btn-primary btn-sm" type="button" (click)="SelectAll(false)">
                  UnSelect All
                </button>
              </div>
              <div *ngIf="showDeletedUpcomingOrders">
                <button class="btn btn-primary btn-sm" style="width: 120px" type="button" (click)="BackToUpcomingOrders()">
                  Upcoming Orders
                </button>
                <button class="btn btn-primary btn-sm" style="width: 120px" type="button" (click)="Recover()">
                  Recover
                </button>
                <button class="btn btn-primary btn-sm" type="button" (click)="SelectAll(true)">
                  Select All
                </button>
                <button class="btn btn-primary btn-sm" type="button" (click)="SelectAll(false)">
                  UnSelect All
                </button>
              </div>
            </div>

            <div class="row d-flex">
              <div class="col-md-6">
                <span style="font-weight: bold"> Total Orders : </span>
                <!-- <span> -->
                <span>
                  {{ upcomingArray.length ? upcomingArray.length : 0 }}
                </span>
                <!-- / <b>MESH :</b>{{MESHtotalWeight}} /
                                  <b>CORE-CAGE:</b>{{COREtotalWeight}}/ <b>CAB:</b>{{CABtotalWeight}}/
                                  <b>PRE-CAGE:</b>{{PREtotalWeight}} (ton)</span> -->
              </div>
              <!-- <br><br> -->
              <div class="col-md-6 float-right logo">
                <div class="col md- 6 float-right desktop" style="display: flex; justify-content: flex-end">
                  <!-- <span style="color: #0880ae; font-weight: bold;">Color Legend : </span>-->
                  <!-- &nbsp; <div class='box gray' style="background-color: #fbbb6f;"></div> &nbsp; Pending
                              Approval -->
                  <!-- &nbsp;
                    <div class="box color" style="background-color: #dffac7">Shared Orders</div>
                    &nbsp; Shared Orders -->
                  <!-- &nbsp; <div class='box blue'></div> &nbsp; To Deliver on the Next Day -->
                </div>
                <div class="mobile">
                  <!-- <span style="color: #0880ae; font-weight: bold;">Color Legend : </span>-->
                  <!-- &nbsp; <div class='box gray' style="background-color: #fbbb6f;"></div> &nbsp; Pending
                          Approval -->
                  &nbsp;
                  <div class="box color" style="background-color: #dffac7" matTooltip="Shared Orders"></div>
                  &nbsp;
                  <!-- &nbsp; <div class='box blue'></div> &nbsp; To Deliver on the Next Day -->
                </div>
              </div>

              <!-- <div class="col-md-3 float-right">
                              <button class="btn btn-primary btn-sm" type="button" style="width:29%" (click)="Withdraw()"
                                  [disabled]="disablewithdraw" [ngClass]="{'btn-secondary': disablewithdraw===true}">Withdraw</button>
                              <button class="btn btn-primary btn-sm" type="button" style="width:29%"
                                  [ngClass]="{'btn-secondary': disablesubmit===true}" (click)="Submit()"
                                  [disabled]="disablesubmit">Submit</button>
                          </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
